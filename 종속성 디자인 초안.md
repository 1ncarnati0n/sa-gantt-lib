# Cell-to-Cell Dependency System Design

## SA-Gantt-Lib 종속성 연결 시스템 상세 설계서

**버전**: 0.2.0-draft  
**작성일**: 2024-12-09  
**상태**: Design Proposal

---

## 목차

1. [개요](#1-개요)
2. [기존 방식과의 비교](#2-기존-방식과의-비교)
3. [핵심 컨셉](#3-핵심-컨셉)
4. [데이터 모델](#4-데이터-모델)
5. [UI 컴포넌트 설계](#5-ui-컴포넌트-설계)
6. [인터랙션 설계](#6-인터랙션-설계)
7. [연결선 라우팅 알고리즘](#7-연결선-라우팅-알고리즘)
8. [드래그 연동 로직](#8-드래그-연동-로직)
9. [엣지 케이스 처리](#9-엣지-케이스-처리)
10. [구현 우선순위](#10-구현-우선순위)

---

## 1. 개요

### 1.1 배경

건설 공정표에서 작업 간 종속성은 단순한 시작-종료 관계가 아닌, 특정 작업 단계에서 다음 작업의 특정 단계로 연결되는 세밀한 관계를 필요로 합니다.

### 1.2 목표

- 기존 FS/SS/FF/SF 4가지 유형을 넘어선 **유연한 종속성 표현**
- **순작업(Net Work)** 과 **간접작업(Indirect Work)** 바의 개별 일(day) 단위 연결
- 드래그 시 연결된 작업들이 **자동으로 함께 이동**하는 체인 시스템
- 직관적이고 시각적으로 명확한 UI/UX

### 1.3 범위

```
┌─────────────────────────────────────────────────────────────┐
│                      적용 범위                               │
├─────────────────────────────────────────────────────────────┤
│  ✅ Level 2 (Detail View) - 주공정표                          │
│     • 순작업 바 (NET)                                        │
│     • 선간접작업 바 (INDIRECT_PRE)                            │
│     • 후간접작업 바 (INDIRECT_POST)                           │
│                                                             │
│  ⚠️  Level 1 (Master View) - 공구공정표                       │
│     • CP 바 간 연결 (간소화된 버전 적용 검토)                    │
└─────────────────────────────────────────────────────────────┘
```

---

## 2. 기존 방식과의 비교

### 2.1 전통적 종속성 유형 (FS/SS/FF/SF)

```
┌─────────────────────────────────────────────────────────────┐
│  Finish-to-Start (FS)                                       │
│  ─────────────────────                                      │
│  [Task A ████████████]                                      │
│                       └──────► [Task B ████████████]        │
│  "A가 끝나야 B가 시작"                                        │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│  Start-to-Start (SS)                                        │
│  ───────────────────                                        │
│  [Task A ████████████]                                      │
│  ├──────────────────► [Task B ████████████]                 │
│  "A가 시작해야 B도 시작"                                       │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│  Finish-to-Finish (FF)                                      │
│  ─────────────────────                                      │
│  [Task A ████████████]                                      │
│                      ├─────► [Task B ████████████]          │
│  "A가 끝나야 B도 끝남"                                         │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│  Start-to-Finish (SF)                                       │
│  ────────────────────                                       │
│  [Task A ████████████]                                      │
│  ├─────────────────────────────────────────►│[Task B]       │
│  "A가 시작해야 B가 끝남" (매우 드문 케이스)                       │
└─────────────────────────────────────────────────────────────┘
```

### 2.2 한계점

| 문제점 | 설명 |
|--------|------|
| **단순함** | 바 전체를 하나의 단위로만 취급 |
| **유연성 부족** | 4가지 유형으로만 관계 표현 |
| **건설 도메인 부적합** | 순작업/간접작업 구분 불가 |
| **중간 지점 연결 불가** | 작업 중간 시점 연결 표현 어려움 |

### 2.3 새로운 Cell-to-Cell 방식

```
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│  기존: 바 전체 ↔ 바 전체                                      │
│  ════════════════════════                                    │
│                                                             │
│  [████████████]──────────────►[████████████]                │
│   Task A (전체)                 Task B (전체)                │
│                                                             │
│                          ▼                                  │
│                                                             │
│  신규: 특정 칸 ↔ 특정 칸                                      │
│  ════════════════════════                                    │
│                                                             │
│  [██│██│██│██│██│██]                                        │
│   1  2  3  4  5  6                                          │
│            │                                                │
│            │ (3번째 칸에서)                                  │
│            │                                                │
│            └────────────────►●                              │
│                              │                              │
│                    [██│██│██│██│██]                         │
│                     1  2  3  4  5                           │
│                     ↑                                       │
│                     (1번째 칸으로)                           │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 3. 핵심 컨셉

### 3.1 바 유형 (Bar Types)

Level 2 (Detail View)에서 각 작업은 최대 3개의 바로 구성됩니다:

```
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│  작업: "갱폼설치"                                             │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐    │
│  │  INDIRECT_PRE (선간접작업) - 파란색                    │    │
│  │  ┌─────┬─────┬─────┐                                │    │
│  │  │  1  │  2  │  3  │  준비/양생/검측 등              │    │
│  │  └─────┴─────┴─────┘                                │    │
│  └─────────────────────────────────────────────────────┘    │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐    │
│  │  NET (순작업) - 빨간색                                 │    │
│  │  ┌─────┬─────┬─────┬─────┬─────┬─────┬─────┐        │    │
│  │  │  1  │  2  │  3  │  4  │  5  │  6  │  7  │ 실작업 │    │
│  │  └─────┴─────┴─────┴─────┴─────┴─────┴─────┘        │    │
│  └─────────────────────────────────────────────────────┘    │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐    │
│  │  INDIRECT_POST (후간접작업) - 파란색                   │    │
│  │  ┌─────┬─────┬─────┬─────┐                          │    │
│  │  │  1  │  2  │  3  │  4  │  양생/검측/마무리         │    │
│  │  └─────┴─────┴─────┴─────┘                          │    │
│  └─────────────────────────────────────────────────────┘    │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 3.2 연결점 (Anchor Point)

각 바의 각 일(day)은 **하나의 연결점**을 가집니다:

```
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│  연결점 위치: 각 일 칸의 하단 중앙                             │
│                                                             │
│  ┌───────────────────────────────────┐                      │
│  │   Day 1   │   Day 2   │   Day 3   │                      │
│  │           │           │           │                      │
│  │     ●     │     ●     │     ●     │  ← 연결점            │
│  └───────────────────────────────────┘                      │
│        ↓           ↓           ↓                            │
│     Anchor      Anchor      Anchor                          │
│     [0]         [1]         [2]                             │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 3.3 연결 가능 조합

```
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│  Source (선행)              Target (후행)                    │
│  ═══════════════           ═══════════════                   │
│                                                             │
│  ┌─────────────┐           ┌─────────────┐                  │
│  │ NET         │    ───►   │ NET         │  ✅ 가능         │
│  │ (순작업)     │           │ (순작업)     │                  │
│  └─────────────┘           └─────────────┘                  │
│                                                             │
│  ┌─────────────┐           ┌─────────────┐                  │
│  │ NET         │    ───►   │ INDIRECT    │  ✅ 가능         │
│  │ (순작업)     │           │ (간접작업)   │                  │
│  └─────────────┘           └─────────────┘                  │
│                                                             │
│  ┌─────────────┐           ┌─────────────┐                  │
│  │ INDIRECT    │    ───►   │ NET         │  ✅ 가능         │
│  │ (간접작업)   │           │ (순작업)     │                  │
│  └─────────────┘           └─────────────┘                  │
│                                                             │
│  ┌─────────────┐           ┌─────────────┐                  │
│  │ INDIRECT    │    ───►   │ INDIRECT    │  ✅ 가능         │
│  │ (간접작업)   │           │ (간접작업)   │                  │
│  └─────────────┘           └─────────────┘                  │
│                                                             │
│  ⚠️ 동일 작업 내 다른 바 간 연결은 불필요 (암묵적 순서 존재)     │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 4. 데이터 모델

### 4.1 CellDependency 인터페이스

```typescript
/**
 * Cell-to-Cell 종속성 정의
 * 
 * 특정 작업의 특정 바, 특정 일(day)에서
 * 다른 작업의 특정 바, 특정 일(day)로 연결
 */
interface CellDependency {
  /** 고유 식별자 */
  id: string;
  
  /** 소스 (선행 작업) 정보 */
  source: CellAnchor;
  
  /** 타겟 (후행 작업) 정보 */
  target: CellAnchor;
  
  /** 연결 옵션 */
  options: DependencyOptions;
  
  /** 메타데이터 */
  metadata: DependencyMetadata;
}

/**
 * 연결점 (Anchor) 정의
 */
interface CellAnchor {
  /** 작업 ID */
  taskId: string;
  
  /** 바 유형 */
  barType: BarType;
  
  /** 
   * 일(day) 인덱스 (0-based)
   * 해당 바 내에서의 상대적 위치
   */
  dayIndex: number;
  
  /**
   * 절대 날짜 (계산된 값, read-only)
   * 실제 캘린더 상의 날짜
   */
  readonly absoluteDate?: Date;
}

/**
 * 바 유형 열거형
 */
type BarType = 
  | 'NET'           // 순작업 (빨간색)
  | 'INDIRECT_PRE'  // 선간접작업 (파란색)
  | 'INDIRECT_POST'; // 후간접작업 (파란색)

/**
 * 종속성 옵션
 */
interface DependencyOptions {
  /** 
   * 지연일 (Lag)
   * 양수: 선행 완료 후 N일 후 후행 시작
   * 음수: 선행 완료 전 N일에 후행 시작 (겹침)
   * 기본값: 0
   */
  lag: number;
  
  /**
   * 잠금 상태
   * true: 드래그 시 함께 이동하지 않음
   * false: 드래그 시 함께 이동
   */
  isLocked: boolean;
  
  /**
   * 연결 강도 (향후 확장용)
   * 'HARD': 반드시 지켜야 함
   * 'SOFT': 권장 사항
   */
  strength: 'HARD' | 'SOFT';
}

/**
 * 종속성 메타데이터
 */
interface DependencyMetadata {
  /** 생성일시 */
  createdAt: Date;
  
  /** 수정일시 */
  updatedAt: Date;
  
  /** 생성자 */
  createdBy?: string;
  
  /** 비고/설명 */
  description?: string;
  
  /** 커스텀 색상 (null이면 기본값 사용) */
  color?: string | null;
}
```

### 4.2 확장된 ConstructionTask 인터페이스

```typescript
/**
 * 기존 ConstructionTask에 종속성 필드 추가
 */
interface ConstructionTask {
  // ... 기존 필드들 ...
  
  id: string;
  parentId: string | null;
  wbsLevel: 1 | 2;
  type: 'GROUP' | 'CP' | 'TASK';
  name: string;
  startDate: Date;
  endDate: Date;
  
  // Level 2 전용 데이터
  task?: TaskData;
  
  /**
   * 이 작업에서 시작하는 종속성 목록
   * (이 작업이 Source인 경우)
   */
  outgoingDependencies: CellDependency[];
  
  /**
   * 이 작업으로 들어오는 종속성 목록
   * (이 작업이 Target인 경우)
   */
  incomingDependencies: CellDependency[];
}

/**
 * Level 2 작업 데이터 (기존)
 */
interface TaskData {
  /** 순작업일 */
  netWorkDays: number;
  
  /** 선간접작업일 */
  indirectWorkDaysPre: number;
  
  /** 후간접작업일 */
  indirectWorkDaysPost: number;
}
```

### 4.3 사용 예시

```typescript
// 예시: 갱폼설치 순작업 5일차 → 옹벽 철근조립 순작업 1일차 연결

const dependency: CellDependency = {
  id: 'dep-gangform-to-wall',
  
  source: {
    taskId: 'task-gangform-install',
    barType: 'NET',
    dayIndex: 4,  // 5번째 일 (0-based)
  },
  
  target: {
    taskId: 'task-wall-rebar',
    barType: 'NET',
    dayIndex: 0,  // 1번째 일
  },
  
  options: {
    lag: 0,
    isLocked: false,
    strength: 'HARD',
  },
  
  metadata: {
    createdAt: new Date('2024-12-09'),
    updatedAt: new Date('2024-12-09'),
    description: '갱폼 설치 후 철근 작업 시작',
    color: null,
  },
};
```

### 4.4 Zustand Store 확장

```typescript
interface GanttStore {
  // ... 기존 상태 ...
  
  /** 전체 종속성 목록 */
  dependencies: CellDependency[];
  
  /** 현재 드래그 중인 연결 (프리뷰용) */
  pendingConnection: {
    source: CellAnchor;
    mousePosition: { x: number; y: number };
  } | null;
  
  /** 선택된 종속성 ID */
  selectedDependencyId: string | null;
  
  // Actions
  addDependency: (dep: Omit<CellDependency, 'id' | 'metadata'>) => string;
  removeDependency: (id: string) => void;
  updateDependency: (id: string, updates: Partial<CellDependency>) => void;
  
  startConnection: (source: CellAnchor) => void;
  updatePendingConnection: (mousePosition: { x: number; y: number }) => void;
  completeConnection: (target: CellAnchor) => void;
  cancelConnection: () => void;
  
  selectDependency: (id: string | null) => void;
  
  /** 특정 작업과 연결된 모든 종속성 조회 */
  getDependenciesForTask: (taskId: string) => {
    outgoing: CellDependency[];
    incoming: CellDependency[];
  };
  
  /** 순환 종속성 검사 */
  wouldCreateCycle: (source: CellAnchor, target: CellAnchor) => boolean;
}
```

---

## 5. UI 컴포넌트 설계

### 5.1 컴포넌트 계층 구조

```
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│  GanttChart                                                 │
│  └── GanttTimeline                                          │
│      ├── DependencyLayer (SVG)          ← 연결선 렌더링      │
│      │   ├── DependencyLine             ← 개별 연결선        │
│      │   ├── DependencyLine                                 │
│      │   └── PendingConnectionLine      ← 드래그 프리뷰      │
│      │                                                      │
│      └── TaskRowList                                        │
│          └── TaskRow                                        │
│              └── TaskBar                                    │
│                  ├── NetWorkBar                             │
│                  │   └── AnchorPoint[]  ← 연결점들          │
│                  ├── IndirectPreBar                         │
│                  │   └── AnchorPoint[]                      │
│                  └── IndirectPostBar                        │
│                      └── AnchorPoint[]                      │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 5.2 AnchorPoint 컴포넌트

```typescript
interface AnchorPointProps {
  /** 연결점 정보 */
  anchor: CellAnchor;
  
  /** 상태 */
  state: AnchorState;
  
  /** 위치 (픽셀) */
  position: { x: number; y: number };
  
  /** 이벤트 핸들러 */
  onDragStart: (anchor: CellAnchor) => void;
  onDragOver: (anchor: CellAnchor) => void;
  onDrop: (anchor: CellAnchor) => void;
}

type AnchorState = 
  | 'HIDDEN'      // 평소 상태, 보이지 않음
  | 'VISIBLE'     // 바 호버 시, 연결 가능 표시
  | 'ACTIVE'      // 드래그 시작점
  | 'DROP_TARGET' // 드롭 가능 대상
  | 'CONNECTED';  // 이미 연결된 상태
```

#### 연결점 상태별 스타일

```
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│  HIDDEN (평소)                                               │
│  ─────────────                                               │
│  • 렌더링하지 않음 (display: none)                            │
│                                                             │
│                                                             │
│  VISIBLE (바 호버 시)                                         │
│  ────────────────────                                        │
│  ┌─────────────────────┐                                    │
│  │  ●    ●    ●    ●   │  ← 모든 칸 하단에 표시             │
│  └─────────────────────┘                                    │
│                                                             │
│  스타일:                                                     │
│  • 크기: 8px                                                 │
│  • 색상: #9CA3AF (gray-400)                                  │
│  • 투명도: 0.7                                               │
│  • 호버 시: 크기 10px, 투명도 1.0                             │
│                                                             │
│                                                             │
│  ACTIVE (드래그 시작점)                                       │
│  ──────────────────────                                      │
│  ┌─────────────────────┐                                    │
│  │       ◉             │  ← 드래그 시작한 칸                 │
│  └─────────────────────┘                                    │
│                                                             │
│  스타일:                                                     │
│  • 크기: 12px                                                │
│  • 색상: #3B82F6 (blue-500)                                  │
│  • 그림자: 0 0 8px rgba(59, 130, 246, 0.5)                   │
│  • 펄스 애니메이션 (scale 1.0 ↔ 1.2)                         │
│                                                             │
│                                                             │
│  DROP_TARGET (드롭 가능)                                      │
│  ──────────────────────                                      │
│  ┌─────────────────────┐                                    │
│  │  ◎             ◎    │  ← 연결 가능한 타겟 칸들            │
│  └─────────────────────┘                                    │
│                                                             │
│  스타일:                                                     │
│  • 크기: 12px                                                │
│  • 테두리: 2px dashed #3B82F6                                │
│  • 배경: transparent                                         │
│  • 호버 시: 배경 #3B82F6, 테두리 solid                        │
│                                                             │
│                                                             │
│  CONNECTED (연결됨)                                           │
│  ─────────────────                                           │
│  ┌─────────────────────┐                                    │
│  │       ●             │  ← 연결된 칸 (항상 표시)            │
│  └─────────────────────┘                                    │
│                                                             │
│  스타일:                                                     │
│  • 크기: 10px                                                │
│  • 색상: 연결선 색상과 동일 (#374151 또는 커스텀)               │
│  • 항상 visible                                              │
│  • 호버 시: 연결 정보 툴팁 표시                               │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 5.3 DependencyLine 컴포넌트

```typescript
interface DependencyLineProps {
  /** 종속성 데이터 */
  dependency: CellDependency;
  
  /** 소스 위치 (픽셀) */
  sourcePosition: { x: number; y: number };
  
  /** 타겟 위치 (픽셀) */
  targetPosition: { x: number; y: number };
  
  /** 선택 상태 */
  isSelected: boolean;
  
  /** 호버 상태 */
  isHovered: boolean;
  
  /** 이벤트 핸들러 */
  onClick: () => void;
  onDoubleClick: () => void;
  onContextMenu: (e: React.MouseEvent) => void;
}
```

#### 연결선 스타일 가이드

```
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│  기본 상태                                                   │
│  ──────────                                                  │
│                                                             │
│  Source ●═══════════════════════▶ Target                    │
│                                                             │
│  스타일:                                                     │
│  • 색상: #374151 (gray-700)                                  │
│  • 두께: 2px                                                 │
│  • 끝점: 화살표 (▶)                                          │
│  • 경로: Orthogonal (직각 꺾임)                               │
│                                                             │
│                                                             │
│  호버 상태                                                   │
│  ──────────                                                  │
│                                                             │
│  Source ●━━━━━━━━━━━━━━━━━━━━━━━▶ Target                    │
│                                                             │
│  스타일:                                                     │
│  • 색상: #3B82F6 (blue-500)                                  │
│  • 두께: 3px                                                 │
│  • 커서: pointer                                             │
│  • 툴팁: 연결 정보 표시                                       │
│                                                             │
│                                                             │
│  선택 상태                                                   │
│  ──────────                                                  │
│                                                             │
│  Source ◉━━━━━━━━━━━━━━━━━━━━━━━▶◉ Target                   │
│                                                             │
│  스타일:                                                     │
│  • 색상: #3B82F6 (blue-500)                                  │
│  • 두께: 3px                                                 │
│  • 양 끝점 강조 (더 큰 원)                                    │
│  • 그림자 효과                                               │
│                                                             │
│                                                             │
│  잠금 상태 (isLocked: true)                                  │
│  ──────────────────────────                                  │
│                                                             │
│  Source ●╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌▶ Target                    │
│                                                             │
│  스타일:                                                     │
│  • 색상: #9CA3AF (gray-400)                                  │
│  • 두께: 2px                                                 │
│  • 선 스타일: dashed                                         │
│  • 잠금 아이콘 표시 (중간 지점)                               │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 5.4 PendingConnectionLine 컴포넌트

드래그 중 프리뷰 연결선:

```typescript
interface PendingConnectionLineProps {
  /** 시작점 위치 (픽셀) */
  sourcePosition: { x: number; y: number };
  
  /** 마우스 현재 위치 */
  mousePosition: { x: number; y: number };
  
  /** 유효한 타겟 위에 있는지 */
  isValidTarget: boolean;
}
```

```
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│  드래그 중 (유효하지 않은 영역)                                │
│  ────────────────────────────                                │
│                                                             │
│  Source ◉╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌╌ × (마우스)                     │
│                                                             │
│  스타일:                                                     │
│  • 색상: #9CA3AF (gray-400)                                  │
│  • 두께: 2px                                                 │
│  • 선 스타일: dashed                                         │
│  • 끝점: × (연결 불가 표시)                                   │
│                                                             │
│                                                             │
│  드래그 중 (유효한 타겟 위)                                    │
│  ─────────────────────────                                   │
│                                                             │
│  Source ◉━━━━━━━━━━━━━━━━━━━▶ ◎ Target                     │
│                                                             │
│  스타일:                                                     │
│  • 색상: #10B981 (emerald-500)                               │
│  • 두께: 3px                                                 │
│  • 선 스타일: solid                                          │
│  • 끝점: ▶ (연결 가능 표시)                                   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 6. 인터랙션 설계

### 6.1 연결 생성 플로우

```
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│  Step 1: 소스 바 호버                                        │
│  ═════════════════════                                       │
│                                                             │
│  사용자 액션: 작업 바 위에 마우스 올림                          │
│  시스템 반응: 해당 바의 모든 연결점(●) 표시                     │
│                                                             │
│  ┌─────────────────────────────────────┐                    │
│  │  갱폼설치                             │                    │
│  │  ┌────┬────┬────┬────┬────┬────┐   │                    │
│  │  │    │    │    │    │    │    │   │ ← 바              │
│  │  │ ●  │ ●  │ ●  │ ●  │ ●  │ ●  │   │ ← 연결점 표시     │
│  │  └────┴────┴────┴────┴────┴────┘   │                    │
│  └─────────────────────────────────────┘                    │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  Step 2: 연결점 클릭 & 드래그 시작                            │
│  ══════════════════════════════════                          │
│                                                             │
│  사용자 액션: 연결점(●)에서 마우스 다운 후 드래그               │
│  시스템 반응:                                                │
│    - 해당 연결점 ACTIVE 상태로 변경 (◉)                       │
│    - 점선 프리뷰 라인 표시                                    │
│    - 다른 모든 작업의 연결점 DROP_TARGET 상태로 표시 (◎)       │
│                                                             │
│  ┌─────────────────────────────────────┐                    │
│  │  갱폼설치                             │                    │
│  │  ┌────┬────┬────┬────┬────┬────┐   │                    │
│  │  │    │    │ ◉──┼────┼────┼────┼───┼─╌╌╌→              │
│  │  └────┴────┴────┴────┴────┴────┘   │        (드래그)    │
│  └─────────────────────────────────────┘                    │
│                                                             │
│  ┌─────────────────────────────────────┐                    │
│  │  옹벽 철근조립                        │                    │
│  │  ┌────┬────┬────┬────┐             │                    │
│  │  │ ◎  │ ◎  │ ◎  │ ◎  │             │ ← 드롭 가능 표시   │
│  │  └────┴────┴────┴────┘             │                    │
│  └─────────────────────────────────────┘                    │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  Step 3: 타겟 위에서 드롭                                     │
│  ════════════════════════                                    │
│                                                             │
│  사용자 액션: 타겟 연결점(◎) 위에서 마우스 업                   │
│  시스템 반응:                                                │
│    - 새 종속성 생성                                          │
│    - 실선 연결선 렌더링                                       │
│    - 연결된 양쪽 연결점 CONNECTED 상태(●)                     │
│    - 성공 피드백 (짧은 애니메이션)                             │
│                                                             │
│  ┌─────────────────────────────────────┐                    │
│  │  갱폼설치                             │                    │
│  │  ┌────┬────┬────┬────┬────┬────┐   │                    │
│  │  │    │    │ ●──┼────┼────┼────┼───┤                    │
│  │  └────┴────┴────┴────┴────┴────┘   │                    │
│  └─────────────────────────────────────│────────────────────┤
│                                        │                    │
│                                        └─────────┐          │
│                                                  │          │
│                                                  ▼          │
│  ┌─────────────────────────────────────┐         │          │
│  │  옹벽 철근조립                        ●─────────┘          │
│  │  ┌────┬────┬────┬────┐             │                    │
│  │  │    │    │    │    │             │                    │
│  │  └────┴────┴────┴────┘             │                    │
│  └─────────────────────────────────────┘                    │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 6.2 연결 편집/삭제 플로우

```
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│  연결선 선택                                                  │
│  ══════════════                                              │
│                                                             │
│  사용자 액션: 연결선 클릭                                      │
│  시스템 반응:                                                │
│    - 연결선 선택 상태로 변경 (굵은 파란선)                      │
│    - 양 끝점 강조                                            │
│    - 편집 툴바 또는 팝오버 표시                               │
│                                                             │
│  ┌─────────────────────────────────────────────────────────┐│
│  │                     ┌──────────────────┐                ││
│  │                     │  🔓 잠금  │  🗑️ 삭제  │                ││
│  │                     │  ⚙️ 설정  │           │                ││
│  │                     └──────────────────┘                ││
│  │                           ↑                             ││
│  │  Source ◉━━━━━━━━━━━━━━━━━━━━━━━━━━━━━▶◉ Target         ││
│  │                                                         ││
│  └─────────────────────────────────────────────────────────┘│
│                                                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  삭제 방법                                                   │
│  ═════════                                                   │
│                                                             │
│  방법 1: 선택 후 Delete 키                                    │
│  방법 2: 선택 후 팝오버에서 삭제 버튼                          │
│  방법 3: 연결선 우클릭 → 컨텍스트 메뉴 → 삭제                  │
│                                                             │
│  삭제 시:                                                    │
│    - 확인 다이얼로그 (선택 사항, 설정으로 끄기 가능)            │
│    - 연결선 페이드 아웃 애니메이션                             │
│    - Undo 스택에 추가                                        │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  옵션 편집                                                   │
│  ═════════                                                   │
│                                                             │
│  더블클릭 또는 팝오버 "설정" 버튼 클릭 시 모달 표시:           │
│                                                             │
│  ┌─────────────────────────────────────────────────────────┐│
│  │                  종속성 설정                              ││
│  │  ─────────────────────────────────────────────────────  ││
│  │                                                         ││
│  │  소스: 갱폼설치 - 순작업 3일차                            ││
│  │  타겟: 옹벽 철근조립 - 순작업 1일차                        ││
│  │                                                         ││
│  │  ┌─────────────────────────────────────────────────┐    ││
│  │  │  지연일 (Lag)                                    │    ││
│  │  │  ┌─────────┐                                    │    ││
│  │  │  │    0    │ 일                                 │    ││
│  │  │  └─────────┘                                    │    ││
│  │  │  (음수: 겹침, 양수: 간격)                         │    ││
│  │  └─────────────────────────────────────────────────┘    ││
│  │                                                         ││
│  │  ┌─────────────────────────────────────────────────┐    ││
│  │  │  ☑ 잠금 (드래그 시 함께 이동하지 않음)            │    ││
│  │  └─────────────────────────────────────────────────┘    ││
│  │                                                         ││
│  │  ┌─────────────────────────────────────────────────┐    ││
│  │  │  비고                                            │    ││
│  │  │  ┌─────────────────────────────────────────┐    │    ││
│  │  │  │                                         │    │    ││
│  │  │  └─────────────────────────────────────────┘    │    ││
│  │  └─────────────────────────────────────────────────┘    ││
│  │                                                         ││
│  │              [ 취소 ]        [ 저장 ]                    ││
│  └─────────────────────────────────────────────────────────┘│
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 6.3 키보드 단축키

| 단축키 | 동작 | 조건 |
|--------|------|------|
| `Delete` / `Backspace` | 선택된 연결 삭제 | 연결선 선택 시 |
| `Escape` | 드래그 취소 / 선택 해제 | 드래그 중 또는 선택 시 |
| `Ctrl+Z` | 실행 취소 | 연결 생성/삭제 후 |
| `Ctrl+Shift+Z` | 다시 실행 | Undo 후 |
| `L` | 선택된 연결 잠금 토글 | 연결선 선택 시 |

---

## 7. 연결선 라우팅 알고리즘

### 7.1 기본 원칙

연결선은 **직각 꺾임(Orthogonal Routing)** 방식을 사용합니다:

```
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│  원칙 1: 최소 꺾임                                           │
│  ──────────────────                                          │
│                                                             │
│  좋음 (1회 꺾임):                                            │
│                                                             │
│  Source ●──────┐                                            │
│                │                                            │
│                └──────● Target                              │
│                                                             │
│  피해야 함 (불필요한 다중 꺾임):                               │
│                                                             │
│  Source ●──┐                                                │
│            └──┐                                             │
│               └──┐                                          │
│                  └──● Target                                │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  원칙 2: 바 회피                                             │
│  ─────────────────                                           │
│                                                             │
│  연결선이 다른 작업 바를 통과하지 않도록 우회:                  │
│                                                             │
│  Source ●───┐                                               │
│             │                                               │
│  [다른 작업] │ ← 이 바를 피해서                              │
│             │                                               │
│             └───● Target                                    │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  원칙 3: 읽기 방향 우선                                       │
│  ────────────────────                                        │
│                                                             │
│  좌→우, 상→하 방향이 자연스러움:                              │
│                                                             │
│  Source ●                                                   │
│         │                                                   │
│         └────────────● Target                               │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 7.2 라우팅 케이스

```typescript
type RoutingCase = 
  | 'BELOW_RIGHT'   // 타겟이 아래 오른쪽
  | 'BELOW_LEFT'    // 타겟이 아래 왼쪽
  | 'ABOVE_RIGHT'   // 타겟이 위 오른쪽
  | 'ABOVE_LEFT'    // 타겟이 위 왼쪽
  | 'SAME_ROW';     // 같은 행
```

```
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│  Case 1: BELOW_RIGHT (가장 일반적)                           │
│  ═══════════════════════════════════                         │
│                                                             │
│  Source ●                                                   │
│         │                                                   │
│         │  (수직 하강)                                       │
│         │                                                   │
│         └────────────────────● Target                       │
│                (수평 이동)                                   │
│                                                             │
│  경로 계산:                                                  │
│  1. Source에서 수직 하강 (Source.y → Target.y)               │
│  2. 수평 이동 (Source.x → Target.x)                          │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  Case 2: BELOW_LEFT                                         │
│  ═══════════════════                                         │
│                                                             │
│                               Source ●                      │
│                                      │                      │
│                                      │                      │
│         Target ●─────────────────────┘                      │
│                                                             │
│  경로 계산:                                                  │
│  1. Source에서 수직 하강                                     │
│  2. 왼쪽으로 수평 이동                                       │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  Case 3: ABOVE_RIGHT (역방향 연결)                           │
│  ═══════════════════════════════════                         │
│                                                             │
│         ┌────────────────────● Target                       │
│         │                                                   │
│         │                                                   │
│  Source ●                                                   │
│                                                             │
│  ⚠️ 시각적으로 역방향임을 표시 (다른 색상 또는 점선)            │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  Case 4: SAME_ROW                                           │
│  ═════════════════                                           │
│                                                             │
│  Source ●────────────────────────────● Target               │
│                                                             │
│  같은 작업의 다른 바 간 연결이 아닌 경우에만 허용              │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 7.3 라우팅 알고리즘 구현

```typescript
interface Point {
  x: number;
  y: number;
}

interface RoutePath {
  points: Point[];
  case: RoutingCase;
}

function calculateRoutePath(
  source: Point,
  target: Point,
  obstacles: Rectangle[],  // 다른 바들의 영역
  config: RoutingConfig
): RoutePath {
  
  const dx = target.x - source.x;
  const dy = target.y - source.y;
  
  // 기본 경로 결정
  let routingCase: RoutingCase;
  let midPoints: Point[];
  
  if (Math.abs(dy) < config.sameRowThreshold) {
    // 같은 행
    routingCase = 'SAME_ROW';
    midPoints = [];  // 직선 연결
    
  } else if (dy > 0) {
    // 타겟이 아래
    routingCase = dx >= 0 ? 'BELOW_RIGHT' : 'BELOW_LEFT';
    
    // 중간점 계산 (L자형)
    const bendY = source.y + dy / 2 + config.verticalOffset;
    midPoints = [
      { x: source.x, y: bendY },  // 수직 하강 후
      { x: target.x, y: bendY },  // 수평 이동
    ];
    
  } else {
    // 타겟이 위
    routingCase = dx >= 0 ? 'ABOVE_RIGHT' : 'ABOVE_LEFT';
    
    const bendY = source.y + dy / 2 - config.verticalOffset;
    midPoints = [
      { x: source.x, y: bendY },
      { x: target.x, y: bendY },
    ];
  }
  
  // 장애물 회피 (선택적)
  if (config.avoidObstacles) {
    midPoints = avoidObstacles(
      [source, ...midPoints, target],
      obstacles,
      config
    );
  }
  
  return {
    points: [source, ...midPoints, target],
    case: routingCase,
  };
}

interface RoutingConfig {
  sameRowThreshold: number;    // 같은 행으로 판단할 Y 차이 (px)
  verticalOffset: number;      // 꺾임점의 수직 오프셋 (px)
  horizontalPadding: number;   // 바로부터의 수평 여백 (px)
  avoidObstacles: boolean;     // 장애물 회피 활성화
}
```

### 7.4 SVG Path 생성

```typescript
function generateSVGPath(route: RoutePath): string {
  const { points } = route;
  
  if (points.length < 2) return '';
  
  // 시작점
  let d = `M ${points[0].x} ${points[0].y}`;
  
  // 각 세그먼트
  for (let i = 1; i < points.length; i++) {
    const prev = points[i - 1];
    const curr = points[i];
    
    // 코너 라운딩 (선택적)
    if (i < points.length - 1) {
      const next = points[i + 1];
      const radius = 5;  // 코너 반경
      
      // 부드러운 코너를 위한 곡선 추가
      d += ` L ${curr.x} ${curr.y}`;
      // 또는 Q (quadratic curve) 사용
    } else {
      d += ` L ${curr.x} ${curr.y}`;
    }
  }
  
  return d;
}
```

---

## 8. 드래그 연동 로직

### 8.1 연결된 작업 자동 이동

Cell-to-Cell 종속성의 핵심 기능: **선행 작업을 드래그하면 후행 작업도 함께 이동**

```
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│  드래그 전                                                   │
│  ══════════                                                  │
│                                                             │
│  [갱폼설치]  ████████████                                    │
│                      │                                      │
│                      └───────────┐                          │
│                                  ▼                          │
│  [옹벽 철근조립]                   ████████                   │
│                                  │                          │
│                                  └───────┐                  │
│                                          ▼                  │
│  [알폼조립]                               ████████████       │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  "갱폼설치"를 오른쪽으로 3일 드래그                            │
│  ══════════════════════════════════════                      │
│                                                             │
│  [갱폼설치]     ████████████  →→→ (3일 이동)                 │
│                         │                                   │
│                         └───────────┐                       │
│                                     ▼                       │
│  [옹벽 철근조립]                      ████████  →→→          │
│                                     │                       │
│                                     └───────┐               │
│                                             ▼               │
│  [알폼조립]                                  ████████████    │
│                                                             │
│  💡 연결된 모든 후행 작업이 동일한 일수만큼 자동 이동          │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 8.2 이동 전파 알고리즘

```typescript
interface MoveResult {
  taskId: string;
  deltadays: number;
  newStartDate: Date;
  newEndDate: Date;
}

/**
 * 작업 이동 시 연결된 작업들의 이동량 계산
 */
function calculateChainMove(
  sourceTaskId: string,
  deltaDays: number,
  dependencies: CellDependency[],
  tasks: Map<string, ConstructionTask>,
  visited: Set<string> = new Set()
): MoveResult[] {
  
  // 순환 방지
  if (visited.has(sourceTaskId)) {
    return [];
  }
  visited.add(sourceTaskId);
  
  const results: MoveResult[] = [];
  const sourceTask = tasks.get(sourceTaskId);
  
  if (!sourceTask) return results;
  
  // 현재 작업 이동
  results.push({
    taskId: sourceTaskId,
    deltaDays,
    newStartDate: addDays(sourceTask.startDate, deltaDays),
    newEndDate: addDays(sourceTask.endDate, deltaDays),
  });
  
  // 이 작업에서 시작하는 종속성 찾기
  const outgoingDeps = dependencies.filter(
    dep => dep.source.taskId === sourceTaskId && !dep.options.isLocked
  );
  
  // 각 후행 작업에 대해 재귀적으로 이동 계산
  for (const dep of outgoingDeps) {
    const childResults = calculateChainMove(
      dep.target.taskId,
      deltaDays,  // 동일한 이동량 전파
      dependencies,
      tasks,
      visited
    );
    results.push(...childResults);
  }
  
  return results;
}
```

### 8.3 잠금(Lock) 처리

```
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│  isLocked: false (기본값)                                    │
│  ══════════════════════════                                  │
│                                                             │
│  [Task A] ●━━━━━━━━━━━▶ [Task B]                            │
│                                                             │
│  Task A 이동 → Task B도 함께 이동                            │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  isLocked: true                                              │
│  ══════════════════                                          │
│                                                             │
│  [Task A] ●╌╌╌╌🔒╌╌╌╌▶ [Task B]                             │
│                                                             │
│  Task A 이동 → Task B는 제자리 유지                          │
│  (연결선이 늘어나거나 줄어듦)                                  │
│                                                             │
│  ⚠️ 잠금된 연결이 논리적으로 불가능해지면 경고 표시            │
│     (예: 선행이 후행보다 늦어지는 경우)                       │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 8.4 충돌 감지 및 경고

```typescript
interface ConflictWarning {
  type: 'OVERLAP' | 'REVERSE_ORDER' | 'CONSTRAINT_VIOLATION';
  dependencyId: string;
  message: string;
  severity: 'WARNING' | 'ERROR';
}

function detectConflicts(
  moveResults: MoveResult[],
  dependencies: CellDependency[],
  tasks: Map<string, ConstructionTask>
): ConflictWarning[] {
  
  const warnings: ConflictWarning[] = [];
  
  // 이동 결과를 임시 적용
  const tempTasks = applyMoves(tasks, moveResults);
  
  for (const dep of dependencies) {
    const sourceTask = tempTasks.get(dep.source.taskId);
    const targetTask = tempTasks.get(dep.target.taskId);
    
    if (!sourceTask || !targetTask) continue;
    
    // 소스 연결점의 절대 날짜 계산
    const sourceDate = getAbsoluteDate(sourceTask, dep.source);
    const targetDate = getAbsoluteDate(targetTask, dep.target);
    
    // 날짜 역전 체크
    if (sourceDate > targetDate) {
      warnings.push({
        type: 'REVERSE_ORDER',
        dependencyId: dep.id,
        message: `"${sourceTask.name}"이 "${targetTask.name}"보다 늦게 시작됩니다`,
        severity: 'ERROR',
      });
    }
    
    // Lag 위반 체크
    const expectedTargetDate = addDays(sourceDate, dep.options.lag);
    if (targetDate.getTime() !== expectedTargetDate.getTime()) {
      warnings.push({
        type: 'CONSTRAINT_VIOLATION',
        dependencyId: dep.id,
        message: `지연일 제약 조건 위반`,
        severity: 'WARNING',
      });
    }
  }
  
  return warnings;
}
```

---

## 9. 엣지 케이스 처리

### 9.1 순환 종속성 방지

```
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│  순환 종속성 예시 (허용하지 않음)                              │
│  ══════════════════════════════════                          │
│                                                             │
│  [Task A] ──────► [Task B]                                  │
│      ▲               │                                      │
│      │               │                                      │
│      │               ▼                                      │
│      └────────── [Task C]                                   │
│                                                             │
│  A → B → C → A (순환!)                                      │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  검증 로직                                                   │
│  ══════════                                                  │
│                                                             │
│  새 연결 생성 전에 순환 여부 체크:                            │
│                                                             │
│  function wouldCreateCycle(                                 │
│    source: CellAnchor,                                      │
│    target: CellAnchor,                                      │
│    existingDeps: CellDependency[]                           │
│  ): boolean {                                               │
│    // DFS로 target에서 source로 도달 가능한지 확인            │
│    // 도달 가능하면 순환 발생                                 │
│  }                                                          │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  사용자 피드백                                               │
│  ══════════════                                              │
│                                                             │
│  순환 감지 시:                                               │
│  - 드래그 중: 연결선 빨간색으로 변경, × 표시                   │
│  - 드롭 시: 연결 생성 거부, 토스트 메시지 표시                 │
│    "순환 종속성이 발생합니다. 연결할 수 없습니다."            │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 9.2 자기 참조 방지

```
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│  동일 작업 내 연결 시도                                       │
│  ════════════════════════                                    │
│                                                             │
│  [갱폼설치]                                                   │
│  ┌──────────────────────────────────┐                       │
│  │  순작업                           │                       │
│  │  ┌────┬────┬────┬────┬────┐     │                       │
│  │  │ ●  │    │    │    │ ●  │     │  ← 같은 작업 내 연결? │
│  │  └─┼──┴────┴────┴────┴─┼──┘     │                       │
│  │    │                   │        │                       │
│  │    └───────────────────┘ ❌      │                       │
│  └──────────────────────────────────┘                       │
│                                                             │
│  규칙: 동일 작업 내 바 간 연결은 허용하지 않음                 │
│  이유: 순작업 → 후간접작업 순서는 암묵적으로 정해져 있음       │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 9.3 중복 연결 방지

```typescript
function isDuplicateConnection(
  newDep: { source: CellAnchor; target: CellAnchor },
  existingDeps: CellDependency[]
): boolean {
  return existingDeps.some(dep => 
    dep.source.taskId === newDep.source.taskId &&
    dep.source.barType === newDep.source.barType &&
    dep.source.dayIndex === newDep.source.dayIndex &&
    dep.target.taskId === newDep.target.taskId &&
    dep.target.barType === newDep.target.barType &&
    dep.target.dayIndex === newDep.target.dayIndex
  );
}
```

### 9.4 바 길이 변경 시 처리

```
┌─────────────────────────────────────────────────────────────┐
│                                                             │
│  시나리오: 순작업일이 7일 → 5일로 변경                         │
│  ════════════════════════════════════                        │
│                                                             │
│  변경 전:                                                    │
│  ┌────┬────┬────┬────┬────┬────┬────┐                       │
│  │  1 │  2 │  3 │  4 │  5 │  6 │  7 │                       │
│  └────┴────┴────┴────┴────┴────┴─●──┘                       │
│                                  │                          │
│                                  └─────► [후행 작업]         │
│                                                             │
│  변경 후 (7일차 연결점 → 5일차로 자동 조정):                  │
│  ┌────┬────┬────┬────┬────┐                                 │
│  │  1 │  2 │  3 │  4 │  5 │                                 │
│  └────┴────┴────┴────┴─●──┘                                 │
│                        │                                    │
│                        └─────► [후행 작업]                   │
│                                                             │
│  규칙:                                                       │
│  1. dayIndex가 새 길이보다 크면 → 마지막 칸으로 조정          │
│  2. 사용자에게 변경 알림 (토스트)                             │
│  3. Undo 가능하도록 히스토리에 기록                           │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 9.5 작업 삭제 시 처리

```typescript
function handleTaskDeletion(
  deletedTaskId: string,
  dependencies: CellDependency[]
): {
  toDelete: string[];  // 삭제할 종속성 ID들
  warnings: string[];  // 사용자 경고 메시지들
} {
  
  const toDelete: string[] = [];
  const warnings: string[] = [];
  
  for (const dep of dependencies) {
    // 이 작업이 소스인 종속성
    if (dep.source.taskId === deletedTaskId) {
      toDelete.push(dep.id);
      warnings.push(
        `"${getTaskName(dep.target.taskId)}"로의 연결이 삭제됩니다.`
      );
    }
    
    // 이 작업이 타겟인 종속성
    if (dep.target.taskId === deletedTaskId) {
      toDelete.push(dep.id);
      warnings.push(
        `"${getTaskName(dep.source.taskId)}"에서의 연결이 삭제됩니다.`
      );
    }
  }
  
  return { toDelete, warnings };
}
```

---

## 10. 구현 우선순위

### Phase 1: 기본 기능 (MVP)

| 우선순위 | 기능 | 예상 공수 |
|----------|------|-----------|
| P0 | CellDependency 데이터 모델 정의 | 2h |
| P0 | AnchorPoint 컴포넌트 (표시/숨김) | 4h |
| P0 | 드래그로 연결 생성 | 8h |
| P0 | DependencyLine 기본 렌더링 | 4h |
| P0 | 연결 삭제 (Delete 키) | 2h |

**Phase 1 총 예상 공수: 20시간 (약 3일)**

### Phase 2: 인터랙션 개선

| 우선순위 | 기능 | 예상 공수 |
|----------|------|-----------|
| P1 | 연결선 직각 라우팅 | 6h |
| P1 | 드래그 시 연결된 작업 함께 이동 | 8h |
| P1 | 순환 종속성 검증 | 4h |
| P1 | 연결 잠금 기능 | 4h |
| P1 | Undo/Redo 통합 | 4h |

**Phase 2 총 예상 공수: 26시간 (약 4일)**

### Phase 3: 고급 기능

| 우선순위 | 기능 | 예상 공수 |
|----------|------|-----------|
| P2 | 연결 편집 모달 (Lag, 비고 등) | 6h |
| P2 | 장애물 회피 라우팅 | 8h |
| P2 | 연결선 호버/선택 스타일링 | 4h |
| P2 | 충돌 경고 UI | 4h |
| P2 | 컨텍스트 메뉴 | 4h |

**Phase 3 총 예상 공수: 26시간 (약 4일)**

### Phase 4: 최적화 및 마무리

| 우선순위 | 기능 | 예상 공수 |
|----------|------|-----------|
| P3 | 대용량 종속성 성능 최적화 | 8h |
| P3 | 키보드 단축키 완성 | 2h |
| P3 | 접근성 (ARIA) | 4h |
| P3 | 문서화 및 테스트 | 8h |

**Phase 4 총 예상 공수: 22시간 (약 3일)**

---

## 부록: 디자인 토큰

### 색상

```typescript
const DEPENDENCY_COLORS = {
  // 연결선
  line: {
    default: '#374151',    // gray-700
    hover: '#3B82F6',      // blue-500
    selected: '#3B82F6',   // blue-500
    locked: '#9CA3AF',     // gray-400
    invalid: '#EF4444',    // red-500
    preview: '#10B981',    // emerald-500
  },
  
  // 연결점
  anchor: {
    default: '#9CA3AF',    // gray-400
    active: '#3B82F6',     // blue-500
    dropTarget: '#3B82F6', // blue-500
    connected: '#374151',  // gray-700
  },
} as const;
```

### 크기

```typescript
const DEPENDENCY_SIZES = {
  anchor: {
    hidden: 0,
    visible: 8,
    active: 12,
    dropTarget: 12,
    connected: 10,
  },
  
  line: {
    default: 2,
    hover: 3,
    selected: 3,
  },
  
  arrow: {
    width: 8,
    height: 6,
  },
} as const;
```

### 애니메이션

```typescript
const DEPENDENCY_ANIMATIONS = {
  anchor: {
    pulse: 'pulse 1.5s ease-in-out infinite',
    scale: 'transform 150ms ease-out',
  },
  
  line: {
    fadeIn: 'opacity 200ms ease-out',
    stroke: 'stroke 150ms ease-out',
  },
} as const;
```

---

## 문서 이력

| 버전 | 날짜 | 작성자 | 변경 내용 |
|------|------|--------|-----------|
| 0.1.0 | 2024-12-09 | - | 초안 작성 |

---

*이 문서는 SA-Gantt-Lib v0.2.0 종속성 기능 개발을 위한 설계 문서입니다.*
